1:"$Sreact.fragment"
2:I[58522,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],""]
18:I[49558,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"AdSenseCard"]
19:I[9725,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
1a:I[89864,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
1b:I[71933,["/_next/static/chunks/be77d35d8dddc77a.js","/_next/static/chunks/0a126d9629c9d34c.js"],"OutletBoundary"]
1c:"$Sreact.suspense"
:HL["/images/20200512_auto_deploy.png","image"]
0:{"buildId":"wycode_has_super_power","rsc":["$","$1","c",{"children":[["$","div",null,{"className":"container mx-auto w-full p-4","children":[["$","article",null,{"className":"card shadow bg-base-100 p-4 mb-4","children":[["$","h1",null,{"className":"text-2xl text-slate-800 dark:text-slate-200 font-extrabold text-center","children":"基于Docker的自动化部署"}],["$","div",null,{"className":"flex justify-between text-sm mb-4 flex-wrap gap-2","children":[["$","span",null,{"className":"flex items-center","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}]]}],"2021-05-09"]}],["$","$L2",null,{"href":"/blog/category/ci-cd","className":"flex items-center px-3 py-1 bg-pink-50 hover:bg-pink-100 dark:bg-pink-900/30 dark:hover:bg-pink-900/50 text-sm rounded-full","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-4 mb-0.5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}]]}],"CI CD"]}]]}],["$","div",null,{"className":"flex items-center gap-2 mb-4","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}],["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6 6h.008v.008H6V6Z"}]]}],["$","div",null,{"className":"flex flex-wrap gap-1","children":[["$","$L2","Watchtower",{"href":"/blog/tag/watchtower","className":"px-2 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 text-sm rounded-full","children":"Watchtower"}],["$","$L2","Docker",{"href":"/blog/tag/docker","className":"px-2 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 text-sm rounded-full","children":"Docker"}],["$","$L2","NodeJS",{"href":"/blog/tag/nodejs","className":"px-2 bg-pink-50 hover:bg-pink-100 dark:bg-pink-900/30 dark:hover:bg-pink-900/50 text-sm rounded-full","children":"NodeJS"}]]}]]}],["$","div",null,{"className":"mt-4","children":["$","div",null,{"className":"prose max-w-full","children":[["$","figure","img-0",{"className":"flex flex-col items-center","children":[["$","img",null,{"src":"/images/20200512_auto_deploy.png","alt":"flow","node":{"type":"element","tagName":"img","properties":{"src":"/images/20200512_auto_deploy.png","alt":"flow"},"children":[],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":42,"offset":42}}},"className":"mx-auto max-h-64 max-w-72"}],["$","figcaption",null,{"className":"text-sm text-gray-500 dark:text-gray-400 mt-1","children":"flow"}]]}],"\n",["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":["之前写过一篇文章关于",["$","a","a-0",{"href":"/2020-10-28-github-action.html","children":"使用Github Action进行持续集成"}],"。\n但是如何将构建好的软件包，分发到运行环境？托付给自动化服务后如何保证服务器安全？Docker化部署的话，服务器上的Docker引擎如何自动检查、拉取、运行最新的镜像？\n本文介绍如何解决这些问题。"]}],"\n"]}],"\n","<!--more-->","\n",["$","h2","h2-0",{"children":"镜像分发"}],"\n","$L3","\n","$L4","\n","$L5","\n","$L6","\n","$L7","\n","$L8","\n","$L9","\n","$La","\n","$Lb","\n","$Lc","\n","$Ld","\n","$Le","\n","$Lf","\n","$L10","\n","$L11"]}]}]]}],"$L12","$L13","$L14"]}],["$L15","$L16"],"$L17"]}],"loading":null,"isPartial":false}
3:["$","p","p-0",{"children":["对于Docker构建的镜像，我们可以将其推送到Docker hub之类的镜像仓库。\n然后在服务器上运行",["$","code","code-0",{"children":"docker pull <Image Name>"}],"或者",["$","code","code-1",{"children":"docker-compose pull <Service>"}],"就可以将镜像拉下来。\n然后再重新运行就可以了。"]}]
4:["$","p","p-1",{"children":"这种方式解决了服务器的安全问题。"}]
5:["$","p","p-2",{"children":"但是如何将这一套流程自动化呢。"}]
6:["$","h2","h2-1",{"children":"自动检查镜像更新和重新运行"}]
7:["$","p","p-3",{"children":"一个思路就是专门写一个守护程序，在接收到某种API请求时，执行以上的操作。但是这样它就脱离了Docker的管理，而且其本身也是需要维护和部署的。"}]
8:["$","p","p-4",{"children":["但是如果将它也作为Docker镜像的话，",["$","code","code-0",{"children":"Container"}],"又如何控制宿主机中的",["$","code","code-1",{"children":"Docker Engine"}],"呢？"]}]
9:["$","p","p-5",{"children":["这也有办法，我们只需要将",["$","code","code-0",{"children":"Host"}],"的Docker域套接字(",["$","code","code-1",{"children":"UNIX domain socket"}],")，挂载到",["$","code","code-2",{"children":"Container"}],"中："]}]
a:["$","div","pre-0",{"dangerouslySetInnerHTML":{"__html":"<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ...</span><span style=\"color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -v</span><span style=\"color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /var/run/docker.sock:/var/run/docker.sock</span></span>\n<span class=\"line\"></span></code></pre>"}}]
b:["$","p","p-6",{"children":["因为Docker是CS模式，这样",["$","code","code-0",{"children":"Container"}],"就可以控制宿主机的Docker引擎，以实现上述操作了。有人将其称为",["$","code","code-1",{"children":"Docker in Docker"}],"。"]}]
c:["$","p","p-7",{"children":"而以上这个思路已经有人造好轮子了。"}]
d:["$","h2","h2-2",{"children":"Watchtower"}]
e:["$","p","p-8",{"children":"Watchtower本身就是一个Docker镜像，支持定时、或者API Hook等方式触发检查，在发现有更新的镜像时，它会停止当前运行的容器，自动拉取镜像，重新以之前运行的参数重启容器，完美解决我们的需求。"}]
f:["$","p","p-9",{"children":"最终的流程参考文章开头的流程图。"}]
10:["$","p","p-10",{"children":"这样一来，我们只需要push代码，Github Action会自动构建Docker镜像并push到Docker hub，然后curl一下我们的watchtower，它就会自动帮我们拉取并运行最新的镜像了。"}]
11:["$","p","p-11",{"children":["省了不少时间，最重要的：",["$","strong","strong-0",{"children":"不要内卷，要work-life balance"}]]}]
12:["$","$L18",null,{}]
13:["$","$L19",null,{}]
14:["$","$L1a",null,{"postId":"auto-deploy"}]
15:["$","script","script-0",{"src":"/_next/static/chunks/473a1be2867482bb.js","async":true}]
16:["$","script","script-1",{"src":"/_next/static/chunks/a5d1ba47f41dfe06.js","async":true}]
17:["$","$L1b",null,{"children":["$","$1c",null,{"name":"Next.MetadataOutlet","children":"$@1d"}]}]
1d:null
