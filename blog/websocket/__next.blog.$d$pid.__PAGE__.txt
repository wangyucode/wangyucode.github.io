1:"$Sreact.fragment"
2:I[58522,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],""]
33:I[49558,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"AdSenseCard"]
34:I[9725,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
35:I[89864,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
36:I[71933,["/_next/static/chunks/be77d35d8dddc77a.js","/_next/static/chunks/0a126d9629c9d34c.js"],"OutletBoundary"]
37:"$Sreact.suspense"
:HL["/apps/chat2.png","image"]
0:{"buildId":"wycode_has_super_power","rsc":["$","$1","c",{"children":[["$","div",null,{"className":"container mx-auto w-full p-4","children":[["$","article",null,{"className":"card shadow bg-base-100 p-4 mb-4","children":[["$","h1",null,{"className":"text-2xl text-slate-800 dark:text-slate-200 font-extrabold text-center","children":"使用WebSocket和STOMP协议开发一个匿名聊天室"}],["$","div",null,{"className":"flex justify-between text-sm mb-4 flex-wrap gap-2","children":[["$","span",null,{"className":"flex items-center","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}]]}],"2020-03-09"]}],["$","$L2",null,{"href":"/blog/category/backend","className":"flex items-center px-3 py-1 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 text-sm rounded-full","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-4 mb-0.5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}]]}],"Backend"]}]]}],["$","div",null,{"className":"flex items-center gap-2 mb-4","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}],["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6 6h.008v.008H6V6Z"}]]}],["$","div",null,{"className":"flex flex-wrap gap-1","children":[["$","$L2","WebSocket",{"href":"/blog/tag/websocket","className":"px-2 bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/30 dark:hover:bg-indigo-900/50 text-sm rounded-full","children":"WebSocket"}],["$","$L2","Spring Boot",{"href":"/blog/tag/spring-boot","className":"px-2 bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/30 dark:hover:bg-indigo-900/50 text-sm rounded-full","children":"Spring Boot"}],["$","$L2","Kotlin",{"href":"/blog/tag/kotlin","className":"px-2 bg-green-50 hover:bg-green-100 dark:bg-green-900/30 dark:hover:bg-green-900/50 text-sm rounded-full","children":"Kotlin"}]]}]]}],["$","div",null,{"className":"mt-4","children":["$","div",null,{"className":"prose max-w-full","children":[["$","figure","img-0",{"className":"flex flex-col items-center","children":[["$","img",null,{"src":"/apps/chat2.png","alt":"chat","node":{"type":"element","tagName":"img","properties":{"src":"/apps/chat2.png","alt":"chat"},"children":[],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":25,"offset":25}}},"className":"mx-auto max-h-64 max-w-72"}],["$","figcaption",null,{"className":"text-sm text-gray-500 dark:text-gray-400 mt-1","children":"chat"}]]}],"\n",["$","p","p-0",{"children":"有时候就想和其他人安全地聊个天，它需要有这些特征："}],"\n",["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":"基于web技术，只需一个网页，无需下载任何App，易于转发。"}],"\n",["$","li","li-1",{"children":"无需注册，使用简单，基于邀请码加入聊天，邀请码定时刷新。"}],"\n",["$","li","li-2",{"children":"完全匿名。"}],"\n",["$","li","li-3",{"children":"消息只保留在内存中，超时自动删除。"}],"\n",["$","li","li-4",{"children":"进行在线人数统计，能设置最大人数上限。"}],"\n","$L3","\n","$L4","\n"]}],"\n","$L5","\n","$L6","\n","$L7","\n","<!--more-->","\n","$L8","\n","$L9","\n","$La","\n","$Lb","\n","$Lc","\n","$Ld","\n","$Le","\n","$Lf","\n","$L10","\n","$L11","\n","$L12","\n","$L13","\n","$L14","\n","$L15","\n","$L16","\n","$L17","\n","$L18","\n","$L19","\n","$L1a","\n","$L1b","\n","$L1c","\n","$L1d","\n","$L1e","\n","$L1f","\n","$L20","\n","$L21","\n","$L22","\n","$L23","\n","$L24","\n","$L25","\n","$L26"]}]}]]}],"$L27","$L28","$L29"]}],["$L2a","$L2b"],"$L2c"]}],"loading":null,"isPartial":false}
3:["$","li","li-5",{"children":"用户上下线和邀请码刷新时有系统提示。"}]
4:["$","li","li-6",{"children":"Web连接必然是不稳定的，所以断线必须能够重连。"}]
5:["$","p","p-1",{"children":["线上Demo演示请直接访问: ",["$","a","a-0",{"href":"https://wycode.cn/lab/chat","children":"https://wycode.cn/lab/chat"}]]}]
6:["$","p","p-2",{"children":"技术方面："}]
7:["$","ul","ul-1",{"children":["\n",["$","li","li-0",{"children":["使用",["$","code","code-0",{"children":"WebSocket"}],"协议提供Web上的全双工通信支持。"]}],"\n",["$","li","li-1",{"children":["使用",["$","code","code-0",{"children":"STOMP"}],"作为上层协议，它基于帧(",["$","code","code-1",{"children":"Frame"}],")，和Http请求很类似，提供了一种发布订阅的模式，很适合需求的群聊模式。"]}],"\n",["$","li","li-2",{"children":["后端采用",["$","code","code-0",{"children":"Kotlin"}]," + ",["$","code","code-1",{"children":"SpringBoot"}],"，前端采用",["$","code","code-2",{"children":"Typescript"}]," + ",["$","code","code-3",{"children":"Angular"}]," + ",["$","code","code-4",{"children":"AntDesign"}],"，均使用最新版本。"]}],"\n"]}]
8:["$","h2","h2-0",{"children":"准备SpringBoot工程"}]
9:["$","p","p-3",{"children":["在SpringBoot中使用WebSocket和STOMP很简单，添加",["$","code","code-0",{"children":"spring-boot-starter-websocket"}],"这个starter依赖就可以开始了。"]}]
a:["$","p","p-4",{"children":"工程基于Gradle初始化，核心的几个依赖如下："}]
2d:Tc23,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">implementation</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">org.springframework.boot:spring-boot-starter-websocket</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">implementation</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">org.jetbrains.kotlin:kotlin-reflect</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">implementation</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">org.jetbrains.kotlin:kotlin-stdlib-jdk8</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">implementation</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">(</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">com.fasterxml.jackson.module:jackson-module-kotlin:2.10.+</span><span style="color:light-dark(#B5695977, #C98A7D77);--shiki-light:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"></span></code></pre>b:["$","div","pre-0",{"dangerouslySetInnerHTML":{"__html":"$2d"}}]
c:["$","h2","h2-1",{"children":"配置WebSocket和STOMP"}]
d:["$","p","p-5",{"children":"添加这么一个类："}]
2e:T1d18,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">@Configuration</span></span>
<span class="line"><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">@EnableWebSocketMessageBroker</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">class</span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994"> WebSocketConfig</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> chatService: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">ChatService</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> taskScheduler: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">TaskScheduler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) : </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">WebSocketMessageBrokerConfigurer</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    override</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> configureMessageBroker</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(config: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">MessageBrokerRegistry</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        config.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">enableSimpleBroker</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"/topic/"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"/queue/"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) </span><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">// 1.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                .</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">setTaskScheduler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(taskScheduler) </span><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">// 2.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        config.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">setApplicationDestinationPrefixes</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"/app"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) </span><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">// 3.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    override</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> registerStompEndpoints</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(registry: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">StompEndpointRegistry</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        registry.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">addEndpoint</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"/stomp"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) </span><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">// 4.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                .</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">setAllowedOrigins</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"*"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) </span><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">// 5.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>e:["$","div","pre-1",{"dangerouslySetInnerHTML":{"__html":"$2e"}}]
f:["$","p","p-6",{"children":["这里配置了很多端点(",["$","code","code-0",{"children":"endpoint"}],")，很多时候容易搞混："]}]
10:["$","ol","ol-0",{"children":["\n",["$","li","li-0",{"children":"可以理解为是一些频道"}],"\n",["$","li","li-1",{"children":"用于定时心跳，设置了taskSchedule才能启用心跳（对于没有启用SockJS的项目），不开启心跳的话，不管是客户端还是服务器都很容易断开连接。"}],"\n",["$","li","li-2",{"children":["这里",["$","code","code-0",{"children":"/app"}],"端点是应用的接收前缀，以app开头的路径会进入后端程序处理"]}],"\n",["$","li","li-3",{"children":["这里",["$","code","code-0",{"children":"/stomp"}],"端点是用来握手的，所以前端connect时连接的是这个端点"]}],"\n",["$","li","li-4",{"children":"启用任意远程访问，防止前端出现跨域问题，易于调试，对于生产环境，可以删除"}],"\n"]}]
11:["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":["需要提到的是，官方文档上仍然启用了",["$","code","code-0",{"children":"SockJS"}],"，其实已经不需要了，",["$","code","code-1",{"children":"SockJS"}],"是对于不支持",["$","code","code-2",{"children":"WebSocket"}],"的Polyfill，对于现在的浏览器，其实已经不需要了，参考这个地址：",["$","a","a-0",{"href":"https://caniuse.com/#search=websockets","children":"https://caniuse.com/#search=websockets"}]]}],"\n"]}]
12:["$","h2","h2-2",{"children":"邀请码鉴权"}]
13:["$","p","p-7",{"children":"主要思路："}]
14:["$","ul","ul-2",{"children":["\n",["$","li","li-0",{"children":["配置客户端入口Channel的interceptor。",["$","code","code-0",{"children":"configureClientInboundChannel()"}]]}],"\n",["$","li","li-1",{"children":["在握手阶段，取header。",["$","code","code-0",{"children":"accessor.getNativeHeader(\"code\")"}]]}],"\n",["$","li","li-2",{"children":["code合法就赋予一个用户。",["$","code","code-0",{"children":"accessor.user = ChatUser()"}]]}],"\n",["$","li","li-3",{"children":["出错时，设置一个sessionAttributes。",["$","code","code-0",{"children":"accessor.sessionAttributes!![\"error\"] = \"邀请码错误！\""}]]}],"\n"]}]
15:["$","blockquote","blockquote-1",{"children":["\n",["$","p","p-0",{"children":"这里我尝试了多种办法直接在握手阶段返回错误，但是都失败了，所以最终通过sessionAttributes来标记错误，在下一次通信时返回错误信息。"}],"\n"]}]
16:["$","p","p-8",{"children":"此处除了鉴权还做了三件事"}]
17:["$","ol","ol-1",{"children":["\n",["$","li","li-0",{"children":"对于本身分配了id的用户握手时，应当视为重连，而不是新用户，这是断线重连实现的关键。"}],"\n",["$","li","li-1",{"children":"新用户进入时要进行人数上限的判断，人满时也报错。"}],"\n",["$","li","li-2",{"children":"因为只有进入聊天室的人才能看到邀请码，所以这里还判断了一个超级用户码，用户以超级用户码进入时，会把当前的邀请码以错误码的形式返回。这样管理员就能方便的知道当前的邀请码了。"}],"\n"]}]
18:["$","h2","h2-3",{"children":"主要接口"}]
19:["$","p","p-9",{"children":[["$","code","code-0",{"children":"controller"}],"只需要两个接口"]}]
1a:["$","ol","ol-2",{"children":["\n",["$","li","li-0",{"children":"用来查询当前状态，用户刚进入时会调用，此时会如果有鉴权时的错误信息，会返回错误。如果正常会返回房间的基本信息，以及所有的聊天记录。同时发送系统信息。"}],"\n"]}]
2f:T1861,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">@MessageMapping</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"/status"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">@SendToUser</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"/queue/status"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> status</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(accessor: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">SimpMessageHeaderAccessor</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">): </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">CommonMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">&#x3C;*> {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (accessor.user </span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!=</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676"> null</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        chatService.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">sendSystemMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">200</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, accessor.user</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!!</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">.name)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        CommonMessage.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">success</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">InitData</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(accessor.user</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!!</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">.name.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">toInt</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(), chatService.users.size, chatService.messages, chatService.code,GEN_CODE_TIME_IN_MINUTES, REMOVE_MESSAGE_TIME_IN_MINUTES))</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    } </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">else</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        CommonMessage.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">fail</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(accessor.sessionAttributes</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!!</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">[</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"error"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">] </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> String)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>1b:["$","div","pre-2",{"dangerouslySetInnerHTML":{"__html":"$2f"}}]
1c:["$","ol","ol-3",{"start":2,"children":["\n",["$","li","li-0",{"children":"发送消息，添加到聊天记录即可。"}],"\n"]}]
30:T1024,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">@MessageMapping</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"/all"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> all</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(message: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">String</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, user: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">Principal</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">): </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">CommonMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">&#x3C;</span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">ChatMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">> {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">    val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> msg </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> ChatMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(user.name.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">toInt</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(), </span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">Date</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(), message, </span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    chatService.messages.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">add</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> CommonMessage.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">success</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>1d:["$","div","pre-3",{"dangerouslySetInnerHTML":{"__html":"$30"}}]
1e:["$","h2","h2-4",{"children":"定时服务及系统消息"}]
1f:["$","p","p-10",{"children":[["$","code","code-0",{"children":"ChatService"}],"中要维护所有用户、历史消息记录、邀请码"]}]
20:["$","ol","ol-4",{"children":["\n",["$","li","li-0",{"children":["所有用户是一个HashSet，",["$","code","code-0",{"children":"var users =  HashSet<ChatUser>()"}],"，",["$","code","code-1",{"children":"ChatUser"}],"使用id作为",["$","code","code-2",{"children":"hashcode"}],"。"]}],"\n",["$","li","li-1",{"children":"更新邀请码的频率较高，所以会同时检查过期消息并移除"}],"\n"]}]
31:Tf75,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> generateCode</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">() {</span></span>
<span class="line"><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">    this</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">.code </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> randomString</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">16</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    logger.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">info</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">${</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">Date</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">toLocaleString</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">()</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">}</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">: $code"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">    this</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">sendSystemMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">100</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">this</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">.code)</span></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">    removeOutdatedMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>21:["$","div","pre-4",{"dangerouslySetInnerHTML":{"__html":"$31"}}]
22:["$","ol","ol-5",{"start":3,"children":["\n",["$","li","li-0",{"children":"移除过期消息，消息列表是一个队列，如果队列头部的消息已过期，需要递归检查下一个"}],"\n"]}]
32:T16cf,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> removeOutdatedMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">() {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    logger.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">info</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">${</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">Date</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">toLocaleString</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">()</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">}</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">: removeOutdatedMessage"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (messages.size </span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">></span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> message </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> messages[</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">]</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">Date</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().time </span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">-</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> message.time.time </span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">></span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> REMOVE_MESSAGE_TIME_IN_MINUTES </span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">*</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 60L</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676"> *</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91"> 1000</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            messages.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">removeAt</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">            removeOutdatedMessage</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>23:["$","div","pre-5",{"dangerouslySetInnerHTML":{"__html":"$32"}}]
24:["$","p","p-11",{"children":["至此，后端核心技术要点已介绍完毕，最后放上github仓库，完整代码：",["$","a","a-0",{"href":"https://github.com/wangyucode/chatroom-spring-websocket-stomp","children":"https://github.com/wangyucode/chatroom-spring-websocket-stomp"}]]}]
25:["$","p","p-12",{"children":["线上完整项目演示请直接访问: ",["$","a","a-0",{"href":"https://wycode.cn/lab/chat","children":"https://wycode.cn/lab/chat"}]]}]
26:["$","p","p-13",{"children":"基于Angular的前端项目将在下篇博客介绍。"}]
27:["$","$L33",null,{}]
28:["$","$L34",null,{}]
29:["$","$L35",null,{"postId":"websocket"}]
2a:["$","script","script-0",{"src":"/_next/static/chunks/473a1be2867482bb.js","async":true}]
2b:["$","script","script-1",{"src":"/_next/static/chunks/a5d1ba47f41dfe06.js","async":true}]
2c:["$","$L36",null,{"children":["$","$37",null,{"name":"Next.MetadataOutlet","children":"$@38"}]}]
38:null
