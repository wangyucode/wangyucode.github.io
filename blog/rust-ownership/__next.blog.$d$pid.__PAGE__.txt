1:"$Sreact.fragment"
2:I[58522,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],""]
26:I[49558,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"AdSenseCard"]
27:I[9725,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
28:I[89864,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
29:I[71933,["/_next/static/chunks/be77d35d8dddc77a.js","/_next/static/chunks/0a126d9629c9d34c.js"],"OutletBoundary"]
2a:"$Sreact.suspense"
:HL["https://www.rust-lang.org/static/images/rust-logo-blk.svg","image"]
:HL["https://doc.rust-lang.org/book/img/trpl04-04.svg","image"]
0:{"buildId":"wycode_has_super_power","rsc":["$","$1","c",{"children":[["$","div",null,{"className":"container mx-auto w-full p-4","children":[["$","article",null,{"className":"card shadow bg-base-100 p-4 mb-4","children":[["$","h1",null,{"className":"text-2xl text-slate-800 dark:text-slate-200 font-extrabold text-center","children":"理解Rust语言的所有权以及借用、引用、切片。"}],["$","div",null,{"className":"flex justify-between text-sm mb-4 flex-wrap gap-2","children":[["$","span",null,{"className":"flex items-center","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}]]}],"2021-01-23"]}],["$","$L2",null,{"href":"/blog/category/languages","className":"flex items-center px-3 py-1 bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/30 dark:hover:bg-indigo-900/50 text-sm rounded-full","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-4 mb-0.5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}]]}],"Languages"]}]]}],["$","div",null,{"className":"flex items-center gap-2 mb-4","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}],["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6 6h.008v.008H6V6Z"}]]}],["$","div",null,{"className":"flex flex-wrap gap-1","children":[["$","$L2","Rust",{"href":"/blog/tag/rust","className":"px-2 bg-cyan-50 hover:bg-cyan-100 dark:bg-cyan-900/30 dark:hover:bg-cyan-900/50 text-sm rounded-full","children":"Rust"}]]}]]}],["$","div",null,{"className":"mt-4","children":["$","div",null,{"className":"prose max-w-full","children":[["$","figure","img-0",{"className":"flex flex-col items-center","children":[["$","img",null,{"src":"https://www.rust-lang.org/static/images/rust-logo-blk.svg","alt":"Rust","node":{"type":"element","tagName":"img","properties":{"src":"https://www.rust-lang.org/static/images/rust-logo-blk.svg","alt":"Rust"},"children":[],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":67,"offset":67}}},"className":"mx-auto max-h-64 max-w-72"}],["$","figcaption",null,{"className":"text-sm text-gray-500 dark:text-gray-400 mt-1","children":"Rust"}]]}],"\n",["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":["Rust由Mozilla基金会开发，没有虚拟机和垃圾回收，却又提供了内存安全，有着媲美C/C++的性能，又同时支持命令式函数式编程以及泛型等便利。优雅（上层抽象）和高性能（底层控制）往往是鱼和熊掌不可兼得，但Rust试图挑战这一矛盾。允许你做带垃圾回收的语言（例如Java）做不到的事，比如控制底层。而同时又避免了比如空指针，野指针在内的（例如C/C++）的问题。它被用于开发浏览器引擎(",["$","code","code-0",{"children":"Servo"}],")，操作系统(",["$","code","code-1",{"children":"Redox OS"}],")，并且特别适合开发",["$","code","code-2",{"children":"WebAssembly"}],"和嵌入式，以及高性能的Web服务。"]}],"\n"]}],"\n",["$","blockquote","blockquote-1",{"children":["\n",["$","p","p-0",{"children":["本文介绍Rust语言中和其它语言相比一个非常重要的特性",["$","code","code-0",{"children":"所有权(Ownership)"}],"以及其相关的",["$","code","code-1",{"children":"借用(Borrowing)"}],"，","$L3","，","$L4","的理解和使用。这个特性保证了Rust不需要垃圾回收以及强大的内存安全，同时还能在多线程编程中带来好处。"]}],"\n"]}],"\n","<!--more-->","\n","$L5","\n","$L6","\n","$L7","\n","$L8","\n","$L9","\n","$La","\n","$Lb","\n","$Lc","\n","$Ld","\n","$Le","\n","$Lf","\n","$L10","\n","$L11","\n","$L12","\n","$L13","\n","$L14","\n","$L15","\n","$L16","\n","$L17","\n","$L18","\n","$L19","\n","$L1a","\n","$L1b","\n","$L1c","\n","$L1d","\n","$L1e","\n","$L1f"]}]}]]}],"$L20","$L21","$L22"]}],["$L23","$L24"],"$L25"]}],"loading":null,"isPartial":false}
3:["$","code","code-2",{"children":"引用(References)"}]
4:["$","code","code-3",{"children":"切片(Slice)"}]
5:["$","h2","h2-0",{"children":"所有权(Ownership)"}]
6:["$","p","p-0",{"children":"废话不多说，先看代码:"}]
7:["$","pre","pre-0",{"children":["$","code","code-0",{"className":"language-Rust","children":"let a = 5;\nlet b = a;\nprintln!(\"a->{}, b->{}\", a, b);\n"}]}]
8:["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":["上面的代码会打印出",["$","code","code-0",{"children":"a->5, b->5"}],"，和直觉（其它语言）相同。"]}],"\n",["$","li","li-1",{"children":[["$","code","code-0",{"children":"a"}],"和",["$","code","code-1",{"children":"b"}],"是",["$","code","code-2",{"children":"i32"}],"类型，属于基础数据类型，存储在",["$","strong","strong-0",{"children":"栈"}],"上。"]}],"\n",["$","li","li-2",{"children":["当把",["$","code","code-0",{"children":"b"}],"赋值给",["$","code","code-1",{"children":"a"}],"时，会进行拷贝。所以在栈上会有两个",["$","code","code-2",{"children":"5"}],"。"]}],"\n"]}]
9:["$","p","p-1",{"children":"但是："}]
a:["$","pre","pre-1",{"children":["$","code","code-0",{"className":"language-Rust","children":"let s1 = String::from(\"hello\");\nlet s2 = s1;\nprintln!(\"s1->{}, s2->{}\", s1, s2);\n"}]}]
b:["$","ul","ul-1",{"children":["\n",["$","li","li-0",{"children":["上面的代码无法通过编译。因为",["$","code","code-0",{"children":"s1"}],"的",["$","strong","strong-0",{"children":"所有权"}],"发生了转移(",["$","code","code-1",{"children":"move"}],")。"]}],"\n",["$","li","li-1",{"children":["在把",["$","code","code-0",{"children":"s1"}],"赋值给",["$","code","code-1",{"children":"s2"}],"之后，",["$","code","code-2",{"children":"s1"}],"就无法再使用了。"]}],"\n",["$","li","li-2",{"children":[["$","code","code-0",{"children":"s1"}],"和",["$","code","code-1",{"children":"s2"}],"被存储在",["$","strong","strong-0",{"children":"栈"}],"上，但是",["$","code","code-2",{"children":"hello"}],"这个字符串存储在",["$","strong","strong-1",{"children":"堆"}],"上"]}],"\n",["$","li","li-3",{"children":[["$","code","code-0",{"children":"s1"}],"和",["$","code","code-1",{"children":"s2"}],"是",["$","code","code-2",{"children":"String"}],"类型，",["$","code","code-3",{"children":"String"}],"类型不是基础数据类型，它是实际字符串的基本信息，包含了指向堆内存的指针、长度、容量信息。"]}],"\n",["$","li","li-4",{"children":["赋值时，栈上的",["$","code","code-0",{"children":"String"}],"即指针，长度、容量被拷贝了，但堆上的",["$","code","code-1",{"children":"hello"}],"没有被拷贝。"]}],"\n",["$","li","li-5",{"children":["这样就保证了堆上的内存始终只有一个所有者",["$","code","code-0",{"children":"owner"}],"。"]}],"\n",["$","li","li-6",{"children":["Rust会在",["$","code","code-0",{"children":"Owner"}],"离开作用域后自动释放",["$","code","code-1",{"children":"Drop"}],"它所指向的堆内存。同时避免二次释放带来的内存问题和安全漏洞。"]}],"\n"]}]
c:["$","figure","img-1",{"className":"flex flex-col items-center","children":[["$","img",null,{"src":"https://doc.rust-lang.org/book/img/trpl04-04.svg","alt":"Move","node":{"type":"element","tagName":"img","properties":{"src":"https://doc.rust-lang.org/book/img/trpl04-04.svg","alt":"Move"},"children":[],"position":{"start":{"line":39,"column":1,"offset":1139},"end":{"line":39,"column":58,"offset":1196}}},"className":"mx-auto max-h-64 max-w-72"}],["$","figcaption",null,{"className":"text-sm text-gray-500 dark:text-gray-400 mt-1","children":"Move"}]]}]
d:["$","h2","h2-1",{"children":"引用(References)和借用(Borrowing)"}]
e:["$","p","p-2",{"children":"再看一个函数的例子："}]
f:["$","pre","pre-2",{"children":["$","code","code-0",{"className":"language-Rust","children":"fn main() {\n    let s1 = String::from(\"hello\");\n    let length = get_length(s1);\n    println!(\"{}\",s1);\n}\n\nfn get_length(str: String) -> usize {\n    str.len()\n}\n"}]}]
10:["$","ul","ul-2",{"children":["\n",["$","li","li-0",{"children":["上面的代码无法通过编译，因为",["$","code","code-0",{"children":"s1"}],"的",["$","strong","strong-0",{"children":"所有权"}],"被转移到了",["$","code","code-1",{"children":"get_length"}],"函数里面。并在出了函数之后就被释放了。"]}],"\n",["$","li","li-1",{"children":["其中一个解决方案是让",["$","code","code-0",{"children":"get_length"}],"通过元组",["$","code","code-1",{"children":"tuple"}],"同时返回",["$","code","code-2",{"children":"str"}],"。此时可以用",["$","code","code-3",{"children":"s1"}],"继续接收",["$","code","code-4",{"children":"str"}],"，即隐藏",["$","code","code-5",{"children":"shadowing"}],"。"]}],"\n"]}]
11:["$","p","p-3",{"children":["我们也可以通过传递",["$","strong","strong-0",{"children":"引用"}],["$","code","code-0",{"children":"References"}],"来解决这个问题："]}]
12:["$","pre","pre-3",{"children":["$","code","code-0",{"className":"language-Rust","children":"fn main() {\n    let s1 = String::from(\"hello\");\n    let len = get_length(&s1);\n    println!(\"The length of '{}' is {}.\", s1, len);\n}\n\nfn get_length(str: &String) -> usize {\n    str.len()\n}\n"}]}]
13:["$","p","p-4",{"children":["将获取引用作为函数参数称为",["$","strong","strong-0",{"children":"借用"}],["$","code","code-0",{"children":"borrowing"}]]}]
14:["$","h2","h2-2",{"children":"可变引用（Mutable References）"}]
15:["$","p","p-5",{"children":["如果要在函数内修改",["$","strong","strong-0",{"children":"借用的值"}],"则必须使用可变引用："]}]
16:["$","pre","pre-4",{"children":["$","code","code-0",{"className":"language-Rust","children":"fn main() {\n    let mut s = String::from(\"hello\");\n\n    change(&mut s);\n}\n\nfn change(some_string: &mut String) {\n    some_string.push_str(\", world\");\n}\n"}]}]
17:["$","ul","ul-3",{"children":["\n",["$","li","li-0",{"children":"Rust中所有的变量默认是不可变的，不可变代表了安全。"}],"\n",["$","li","li-1",{"children":["同一作用域中，不可变引用可以有多个，即多个",["$","strong","strong-0",{"children":"读引用"}],"是ok的。但是不能同时存在可变引用和不可变引用。"]}],"\n",["$","li","li-2",{"children":["同一作用域中，可变引用只能有一个，即",["$","strong","strong-0",{"children":"写引用"}],"只能有一个。"]}],"\n"]}]
18:["$","p","p-6",{"children":["这些规则保证了Rust不可能出现",["$","strong","strong-0",{"children":"悬垂指针"}],"（dangling pointer）或",["$","strong","strong-1",{"children":"空指针"}],"（null pointer）异常。\n也减轻了多线程中的",["$","strong","strong-2",{"children":"竞争状态"}],"（Race conditions）和",["$","strong","strong-3",{"children":"死锁"}],"（Deadlocks）问题"]}]
19:["$","h2","h2-3",{"children":"切片(Slice)"}]
1a:["$","p","p-7",{"children":["三句话说清楚切片",["$","code","code-0",{"children":"Slice"}],"："]}]
1b:["$","ul","ul-4",{"children":["\n",["$","li","li-0",{"children":"切片没有所有权，因为它是对数组或者字符串等集合某个区间的不可变引用。"}],"\n",["$","li","li-1",{"children":"它的作用是，我们想使用集合中某个数据，又怕其他人对集合做了修改（比如清空了集合的元素）时能够提前发现bug。"}],"\n",["$","li","li-2",{"children":"原理是上一节提到的，同一作用域不能同时存在可变引用和不可变引用。"}],"\n"]}]
1c:["$","h2","h2-4",{"children":"Rust的缺点"}]
1d:["$","p","p-8",{"children":"目前发现Rust最大的缺点就是：想写一个能够编译通过的代码实在是太难了，哈哈。"}]
1e:["$","p","p-9",{"children":"但正是因为Rust拥有强大的编译器，它能够提前把bug扼杀在摇篮里，在编译阶段就拒绝各种各样的bug，从而同时保证程序的性能和安全。"}]
1f:["$","p","p-10",{"children":["这也是为什么Typescript，敏捷开发，TDD，会火的原因了。",["$","strong","strong-0",{"children":"尽可能早的发现和解决问题。"}]]}]
20:["$","$L26",null,{}]
21:["$","$L27",null,{}]
22:["$","$L28",null,{"postId":"rust-ownership"}]
23:["$","script","script-0",{"src":"/_next/static/chunks/473a1be2867482bb.js","async":true}]
24:["$","script","script-1",{"src":"/_next/static/chunks/a5d1ba47f41dfe06.js","async":true}]
25:["$","$L29",null,{"children":["$","$2a",null,{"name":"Next.MetadataOutlet","children":"$@2b"}]}]
2b:null
