1:"$Sreact.fragment"
2:I[58522,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],""]
1a:I[49558,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"AdSenseCard"]
1b:I[9725,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
1c:I[89864,["/_next/static/chunks/1e02b7c5799ac6a1.js","/_next/static/chunks/3b6828ba17d8ab80.js","/_next/static/chunks/473a1be2867482bb.js","/_next/static/chunks/a5d1ba47f41dfe06.js"],"default"]
1d:I[71933,["/_next/static/chunks/be77d35d8dddc77a.js","/_next/static/chunks/0a126d9629c9d34c.js"],"OutletBoundary"]
1e:"$Sreact.suspense"
:HL["https://issues.jboss.org/secure/attachment/12345694/netty_logo_600px.png","image"]
0:{"buildId":"wycode_has_super_power","rsc":["$","$1","c",{"children":[["$","div",null,{"className":"container mx-auto w-full p-4","children":[["$","article",null,{"className":"card shadow bg-base-100 p-4 mb-4","children":[["$","h1",null,{"className":"text-2xl text-slate-800 dark:text-slate-200 font-extrabold text-center","children":"使用Netty开发高性能的网络服务应用"}],["$","div",null,{"className":"flex justify-between text-sm mb-4 flex-wrap gap-2","children":[["$","span",null,{"className":"flex items-center","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5"}]]}],"2018-10-16"]}],["$","$L2",null,{"href":"/blog/category/backend","className":"flex items-center px-3 py-1 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 text-sm rounded-full","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline mr-1 h-4 mb-0.5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"}]]}],"Backend"]}]]}],["$","div",null,{"className":"flex items-center gap-2 mb-4","children":[["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","aria-hidden":"true","data-slot":"icon","className":"inline h-5","children":[null,["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z"}],["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M6 6h.008v.008H6V6Z"}]]}],["$","div",null,{"className":"flex flex-wrap gap-1","children":[["$","$L2","Netty",{"href":"/blog/tag/netty","className":"px-2 bg-yellow-50 hover:bg-yellow-100 dark:bg-yellow-900/30 dark:hover:bg-yellow-900/50 text-sm rounded-full","children":"Netty"}],["$","$L2","HTTP",{"href":"/blog/tag/http","className":"px-2 bg-blue-50 hover:bg-blue-100 dark:bg-blue-900/30 dark:hover:bg-blue-900/50 text-sm rounded-full","children":"HTTP"}]]}]]}],["$","div",null,{"className":"mt-4","children":["$","div",null,{"className":"prose max-w-full","children":[["$","figure","img-0",{"className":"flex flex-col items-center","children":[["$","img",null,{"src":"https://issues.jboss.org/secure/attachment/12345694/netty_logo_600px.png","alt":"Netty","node":{"type":"element","tagName":"img","properties":{"src":"https://issues.jboss.org/secure/attachment/12345694/netty_logo_600px.png","alt":"Netty"},"children":[],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":83,"offset":83}}},"className":"mx-auto max-h-64 max-w-72"}],["$","figcaption",null,{"className":"text-sm text-gray-500 dark:text-gray-400 mt-1","children":"Netty"}]]}],"\n",["$","blockquote","blockquote-0",{"children":["\n",["$","p","p-0",{"children":"Netty是一个基于异步NIO（non-blocking IO）模型的，事件驱动的网络应用程序框架。"}],"\n"]}],"\n",["$","blockquote","blockquote-1",{"children":["\n",["$","p","p-0",{"children":"不同于传统阻塞IO，非阻塞IO通常使用更少的线程，从而提高并发性能。"}],"\n"]}],"\n",["$","blockquote","blockquote-2",{"children":["\n",["$","p","p-0",{"children":"Netty的灵活设计使得它能够开发几乎所有基于二进制流、文本应用协议的Web应用"}],"\n"]}],"\n",["$","p","p-0",{"children":"这篇文章将简单介绍如何使用Netty开发一个HTTP服务器"}],"\n","<!--more-->","\n","$L3","\n","$L4","\n","$L5","\n","$L6","\n","$L7","\n","$L8","\n","$L9","\n","$La","\n","$Lb","\n","$Lc","\n","$Ld","\n","$Le","\n","$Lf"]}]}]]}],"$L10","$L11","$L12"]}],["$L13","$L14"],"$L15"]}],"loading":null,"isPartial":false}
3:["$","h2","h2-0",{"children":"导入Netty"}]
4:["$","p","p-1",{"children":"这里使用Gradle导入4.1.30.Final版本"}]
16:T4c0,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">dependencies </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">{</span></span>
<span class="line"><span style="color:light-dark(#B31D28, #FDAEB7);--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">	compile</span><span style="color:light-dark(#99841877, #B8A96577);--shiki-light:#99841877;--shiki-dark:#B8A96577"> "</span><span style="color:light-dark(#998418, #B8A965);--shiki-light:#998418;--shiki-dark:#B8A965">io.netty:netty-all:4.1.30.Final</span><span style="color:light-dark(#99841877, #B8A96577);--shiki-light:#99841877;--shiki-dark:#B8A96577">"</span></span>
<span class="line"><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span></code></pre>5:["$","div","pre-0",{"dangerouslySetInnerHTML":{"__html":"$16"}}]
6:["$","h2","h2-1",{"children":"编写服务器"}]
17:T2674,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">class</span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994"> Server</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> port: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">Int</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">    @Throws</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(Exception::</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">class</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">    fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> run</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">() {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> bossGroup </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> NioEventLoopGroup</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> workerGroup </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> NioEventLoopGroup</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        try</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> b </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> ServerBootstrap</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            b.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">group</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(bossGroup, workerGroup)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    .</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">channel</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(NioServerSocketChannel::</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">class</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">.java)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    .</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">handler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">LoggingHandler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(LogLevel.INFO))</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    .</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">childHandler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">ServerInitializer</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">())</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> ch </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> b.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">bind</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(port).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">sync</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">channel</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">            println</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"server start on $port"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            ch.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">closeFuture</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">sync</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        } </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">finally</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            bossGroup.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">shutdownGracefully</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            workerGroup.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">shutdownGracefully</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>7:["$","div","pre-1",{"dangerouslySetInnerHTML":{"__html":"$17"}}]
8:["$","ul","ul-0",{"children":["\n",["$","li","li-0",{"children":["这里",["$","code","code-0",{"children":"bossGroup"}],"是用来接受连接的父线程池，可以是单线程，也可以是多线程（推荐是CPU核心数的倍数）"]}],"\n",["$","li","li-1",{"children":["因为",["$","code","code-0",{"children":"bossGroup"}],"接受连接后会立即返回，不会阻塞，所以即使单线程也能够处理并发（类似Node.JS）"]}],"\n",["$","li","li-2",{"children":[["$","code","code-0",{"children":"workerGroup"}],"是工作线程"]}],"\n",["$","li","li-3",{"children":[["$","code","code-0",{"children":"channel()"}],"设置构建NIO Channel的类型"]}],"\n",["$","li","li-4",{"children":[["$","code","code-0",{"children":"handle()"}],"和",["$","code","code-1",{"children":"childHandle()"}],"分别设置主处理，和子处理对象"]}],"\n"]}]
9:["$","h2","h2-2",{"children":"配置子处理流程"}]
18:T147a,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">class</span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994"> ServerInitializer</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> : </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">ChannelInitializer</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">&#x3C;</span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">SocketChannel</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">>() {</span></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    override</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> initChannel</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(ch: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">SocketChannel</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> p </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> ch.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">pipeline</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        p.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">addLast</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">HttpRequestDecoder</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">())</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        // Uncomment the following line if you don't want to handle HttpChunks.</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        //p.addLast(new HttpObjectAggregator(1048576));</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        p.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">addLast</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">HttpResponseEncoder</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">())</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        // Remove the following line if you don't want automatic content compression.</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        //p.addLast(new HttpContentCompressor());</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        p.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">addLast</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">HttpServerHandler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">())</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>a:["$","div","pre-2",{"dangerouslySetInnerHTML":{"__html":"$18"}}]
b:["$","ul","ul-1",{"children":["\n",["$","li","li-0",{"children":["Netty自带了很多的编解码器，上面的",["$","code","code-0",{"children":"HttpRequestDecoder"}],"和",["$","code","code-1",{"children":"HttpResponseEncoder"}],"用于HTTP协议的编解码"]}],"\n",["$","li","li-1",{"children":["经过编解码后我们的",["$","code","code-0",{"children":"HttpServerHandler"}],"将会实际处理HTTP请求"]}],"\n"]}]
c:["$","h2","h2-3",{"children":"处理HTTP请求"}]
19:Tff2b,<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:light-dark(#ffffff, #121212);--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;color:light-dark(#393a34, #dbd7caee);--shiki-light:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code><span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">class</span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994"> HttpServerHandler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> : </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">SimpleChannelInboundHandler</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">&#x3C;</span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">Any</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">>() {</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">    val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> sb </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> StringBuilder</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    lateinit</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> var</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> request: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">HttpRequest</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    override</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> channelRead0</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(ctx: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">ChannelHandlerContext</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, msg: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">Any</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (msg </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">is</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> HttpRequest) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (HttpUtil.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">is100ContinueExpected</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg)) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                ctx.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">write</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">DefaultFullHttpResponse</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpVersion.HTTP_1_1, HttpResponseStatus.CONTINUE))</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            request </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> msg</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">setLength</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#2F798A, #4C9A91);--shiki-light:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"Welcome</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"=====================</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"VERSION: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">protocolVersion</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"HOSTNAME: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">get</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.HOST, </span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"unknown"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"REQUEST_URI: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">uri</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> headers </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">headers.isEmpty) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                for</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (h </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> headers) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"HEADER: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(h.key).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">" = "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(h.</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">value</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> queryStringDecoder </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> QueryStringDecoder</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">uri</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">())</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> params </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> queryStringDecoder.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">parameters</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">params.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">isEmpty</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                for</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (p </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> params) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                    val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> vals </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> p.</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">value</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                    for</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">value</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> in</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> vals) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                        sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"PARAM: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(p.key).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">" = "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">value</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">            appendDecoderResult</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(sb, msg)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (msg </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">is</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> HttpContent) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> content </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">content</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (content.isReadable) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"CONTENT: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(content.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">toString</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(CharsetUtil.UTF_8))</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">                appendDecoderResult</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(sb, msg)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (msg </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">is</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> LastHttpContent) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"END OF CONTENT</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">trailingHeaders</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().isEmpty) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                    for</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (name </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">trailingHeaders</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">names</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                        for</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">value</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> in</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> msg.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">trailingHeaders</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">getAll</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(name)) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"TRAILING HEADER: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(name).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">" = "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">value</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                        }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">                // Decide whether to close the connection or not.</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">writeResponse</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(msg, ctx)) {</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">                    // If keep-alive is off, close the connection once the content is fully written.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    ctx.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">writeAndFlush</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(Unpooled.EMPTY_BUFFER).</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">addListener</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(ChannelFutureListener.CLOSE)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    override</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> channelReadComplete</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(ctx: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">ChannelHandlerContext</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        ctx.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">flush</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    private</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> writeResponse</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(currentObj: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">HttpObject</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, ctx: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">ChannelHandlerContext</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">): </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">Boolean</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> keepAlive </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> HttpUtil.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">isKeepAlive</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(request)</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        // Build the response object.</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> status </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (currentObj.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">decoderResult</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().isSuccess) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            HttpResponseStatus.OK</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        } </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">else</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            HttpResponseStatus.BAD_REQUEST</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> response </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> DefaultFullHttpResponse</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                HttpVersion.HTTP_1_1, status,</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                Unpooled.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">copiedBuffer</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">toString</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(), CharsetUtil.UTF_8))</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        response.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">set</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.CONTENT_TYPE, </span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">${</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">HttpHeaderValues.TEXT_PLAIN</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">}</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">; charset=UTF-8"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (keepAlive) {</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            // Add 'Content-Length' header only for a keep-alive connection.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            response.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">setInt</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.CONTENT_LENGTH, response.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">content</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">readableBytes</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">())</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            // Add keep alive header as per:</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            // - http://www.w3.org/Protocols/HTTP/1.1/draft-ietf-http-v11-spec-01.html#Connection</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            response.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">set</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        // Encode the cookie.</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> cookieString </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> request.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">get</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.COOKIE)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (cookieString </span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!=</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676"> null</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> cookies </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> ServerCookieDecoder.STRICT.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">decode</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(cookieString)</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (</span><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">!</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">cookies.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">isEmpty</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()) {</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">                // Reset the cookies if necessary.</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                for</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (cookie </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> cookies) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                    response.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">add</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.STRICT.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">encode</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(cookie))</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        } </span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">else</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">            // Browser sent no cookie.  Add some.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            response.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">add</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.STRICT.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">encode</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"key1"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"value1"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">));</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            response.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">headers</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">().</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">add</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.STRICT.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">encode</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"key2"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"value2"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#A0ADA0, #758575DD);--shiki-light:#A0ADA0;--shiki-dark:#758575DD">        // Write the response.</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        ctx.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">write</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(response)</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> keepAlive</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    override</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> exceptionCaught</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(ctx: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">ChannelHandlerContext</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, cause: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">Throwable</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        cause.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">printStackTrace</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        ctx.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">close</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#AB5959, #CB7676);--shiki-light:#AB5959;--shiki-dark:#CB7676">    companion</span><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375"> object</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">        fun</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665"> appendDecoderResult</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(sb: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">StringBuilder</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">, httpObj: </span><span style="color:light-dark(#2E8F82, #5DA994);--shiki-light:#2E8F82;--shiki-dark:#5DA994">HttpObject</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            val</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> result </span><span style="color:light-dark(#999999, #666666);--shiki-light:#999999;--shiki-dark:#666666">=</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> httpObj.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">decoderResult</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">()</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE"> (result.isSuccess) {</span></span>
<span class="line"><span style="color:light-dark(#1E754F, #4D9375);--shiki-light:#1E754F;--shiki-dark:#4D9375">                return</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">".. WITH DECODER FAILURE: "</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(result.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">cause</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">())</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">            sb.</span><span style="color:light-dark(#59873A, #80A665);--shiki-light:#59873A;--shiki-dark:#80A665">append</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">(</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#A65E2B, #C99076);--shiki-light:#A65E2B;--shiki-dark:#C99076">\r\n</span><span style="color:light-dark(#B56959, #C98A7D);--shiki-light:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">        }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">    }</span></span>
<span class="line"><span style="color:light-dark(#393A34, #DBD7CAEE);--shiki-light:#393A34;--shiki-dark:#DBD7CAEE">}</span></span>
<span class="line"></span></code></pre>d:["$","div","pre-3",{"dangerouslySetInnerHTML":{"__html":"$19"}}]
e:["$","ul","ul-2",{"children":["\n",["$","li","li-0",{"children":["如果构造流程时没有使用",["$","code","code-0",{"children":"HttpObjectAggregator"}],"类，",["$","code","code-1",{"children":"channelRead()"}],"会调用很多次，每次传入的对象为",["$","code","code-2",{"children":"HttpRequest"}],"，",["$","code","code-3",{"children":"HttpContent"}],",",["$","code","code-4",{"children":"LastHttpContent"}],"的子类，他们分别有方法可以读取到HTTP请求的内容。"]}],"\n"]}]
f:["$","p","p-2",{"children":"以上，转载请联系作者!"}]
10:["$","$L1a",null,{}]
11:["$","$L1b",null,{}]
12:["$","$L1c",null,{"postId":"netty"}]
13:["$","script","script-0",{"src":"/_next/static/chunks/473a1be2867482bb.js","async":true}]
14:["$","script","script-1",{"src":"/_next/static/chunks/a5d1ba47f41dfe06.js","async":true}]
15:["$","$L1d",null,{"children":["$","$1e",null,{"name":"Next.MetadataOutlet","children":"$@1f"}]}]
1f:null
